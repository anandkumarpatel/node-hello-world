#!/bin/bash
# ./parallel-test.sh <time log>
echo "BUILD_TIME_MS,EXIT_CODE,NUM_PARALLEL,TEST_TIME" > $1
for CUR in `seq 1 50`; do
  ./clean.sh
  echo ",,$CUR" >> $1
  START="$(date +%s%N)"
	for i in `seq 1 $CUR`; do
	  ./runContainer.sh $1 &
	done

	for job in `jobs -p`; do
	  wait $job
	done
  START="$(($(date +%s%N)-START))"
  M="$((START/1000000))"
  echo ",,,$M" >> $1
done
cat $1
